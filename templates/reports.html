<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Reports</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f8f9fa; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; }
        h2 { margin-top: 0; color: #333; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #dc3545; color: white; } /* Red for Admin */
        
        .summary-box { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat { background: #fff; padding: 15px; border-radius: 5px; border-left: 5px solid #dc3545; flex: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div class="header">
        <h1>üìä Admin Dashboard</h1>
        <a href="/menu" style="text-decoration: none; font-weight: bold;">‚Üê Back to Menu</a>
    </div>

    <div class="card">
        <h2>üìÖ Weekly Sales (Last 7 Days)</h2>
        <div class="summary-box">
            <div class="stat">Total Orders: <strong id="week-count">0</strong></div>
            <div class="stat">Total Revenue: <strong id="week-rev">$0.00</strong></div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Orders Count</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody id="week-table"></tbody>
        </table>
    </div>

    <div class="card">
        <h2>üìÜ Monthly Sales (Last 30 Days)</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Orders Count</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody id="month-table"></tbody>
        </table>
    </div>

    <script>
        // Security Check
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user || user.role !== 'Admin') {
            alert("Access Denied: Admins only.");
            window.location.href = '/menu';
        }

        async function loadReports() {
            // 1. Fetch Weekly
            const resWeek = await fetch('/api/reports/weekly');
            const dataWeek = await resWeek.json();
            renderTable('week-table', dataWeek);
            
            // Calculate Summary for Week
            let wCount = 0; 
            let wRev = 0.0;
            dataWeek.forEach(d => { wCount += d.total_orders; wRev += parseFloat(d.total_revenue); });
            document.getElementById('week-count').innerText = wCount;
            document.getElementById('week-rev').innerText = "$" + wRev.toFixed(2);

            // 2. Fetch Monthly
            const resMonth = await fetch('/api/reports/monthly');
            const dataMonth = await resMonth.json();
            renderTable('month-table', dataMonth);
        }

        function renderTable(elementId, data) {
            const tbody = document.getElementById(elementId);
            tbody.innerHTML = '';
            if(data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3">No sales found for this period.</td></tr>';
                return;
            }
            data.forEach(row => {
                const tr = `
                    <tr>
                        <td>${row.report_date}</td>
                        <td>${row.total_orders}</td>
                        <td>$${row.total_revenue}</td>
                    </tr>
                `;
                tbody.innerHTML += tr;
            });
        }

        loadReports();
    </script>
</body>
</html>